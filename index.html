<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DW Location Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            min-height: 100vh; 
            color: white; 
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .panel { 
            background: rgba(255,255,255,0.1); 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
        }
        .btn { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
        .btn:hover { background: #45a049; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-secondary { background: #2196F3; }
        .btn-danger { background: #f44336; }
        input, select { 
            width: 100%; 
            padding: 10px; 
            margin: 5px 0; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
        }
        .hidden { display: none; }
        .alert { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            display: none; 
        }
        .alert.success { background: rgba(76,175,80,0.2); border: 1px solid #4CAF50; }
        .alert.error { background: rgba(244,67,54,0.2); border: 1px solid #f44336; }
        .alert.warning { background: rgba(255,152,0,0.2); border: 1px solid #FF9800; }
        .alert.info { background: rgba(33,150,243,0.2); border: 1px solid #2196F3; }
        .setup-form { background: white; color: black; padding: 20px; border-radius: 10px; }
        .setup-form.hidden { display: none; }
        .demo-data { background: white; color: black; padding: 20px; border-radius: 10px; }
        .demo-location { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px; 
            margin: 5px 0; 
            background: #f5f5f5; 
            border-radius: 5px; 
        }
        .qr-modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.8); 
            display: none; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000; 
        }
        .qr-content { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            text-align: center; 
            color: black; 
        }
        #map { width: 100%; height: 400px; background: rgba(255,255,255,0.1); border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è DW Location Tracker</h1>
            <div id="status">Ready to configure</div>
        </div>

        <div class="panel" id="mainPanel">
            <p style="margin-bottom: 15px;">Click Demo Mode to test or Settings to configure your Google Sheets data.</p>
            <button class="btn" id="initBtn">üöÄ Initialize</button>
            <button class="btn" id="demoBtn">üéÆ Demo Mode</button>
            <button class="btn btn-danger" id="setupBtn">‚öôÔ∏è Settings</button>
            <button class="btn btn-secondary" id="qrBtn" disabled>üì± QR Code</button>
            <button class="btn btn-secondary" id="refreshBtn" disabled>üîÑ Refresh</button>
        </div>

        <div class="setup-form hidden" id="setupForm">
            <h3>Configuration Settings</h3>
            <p><strong>Setup:</strong> Publish your Google Sheet to web as CSV, then enter details below.</p>
            <label>Google Maps API Key:</label>
            <input type="password" id="apiKey" placeholder="Enter API key">
            <label>Google Sheets ID:</label>
            <input type="text" id="sheetId" placeholder="Sheet ID from URL">
            <br><br>
            <button class="btn" id="saveBtn">üíæ Save</button>
            <button class="btn btn-secondary" id="testBtn">üß™ Test</button>
            <button class="btn btn-secondary" id="cancelBtn">‚ùå Cancel</button>
        </div>

        <div id="map">
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; opacity: 0.7;">
                üó∫Ô∏è Map will appear after configuration
            </div>
        </div>

        <div class="demo-data hidden" id="demoData">
            <h3>üìç Demo Locations</h3>
            <div class="demo-location">
                <div><strong>Downtown Store</strong><br>123 Main St, LA</div>
                <div style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 3px;">15</div>
            </div>
            <div class="demo-location">
                <div><strong>Westside Location</strong><br>456 Ocean Ave, SM</div>
                <div style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 3px;">8</div>
            </div>
            <div class="demo-location">
                <div><strong>Hollywood Branch</strong><br>789 Sunset Blvd, Hollywood</div>
                <div style="background: #999; color: white; padding: 5px 10px; border-radius: 3px;">0</div>
            </div>
            <button class="btn btn-secondary" onclick="generateDemoQR()">üì± Demo QR</button>
            <button class="btn" onclick="exitDemo()">‚úï Exit Demo</button>
        </div>

        <div class="qr-modal" id="qrModal">
            <div class="qr-content">
                <h3 id="qrTitle">üì± QR Code</h3>
                <div id="qrCode" style="margin: 20px 0;"></div>
                <div id="qrDesc"></div>
                <button class="btn btn-secondary" onclick="closeQR()">Close</button>
            </div>
        </div>

        <div class="alert" id="alert"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        let isDemoMode = false;
        let appConfig = { apiKey: '', sheetId: '' };

        // Initialize
        document.addEventListener('DOMContentLoaded', init);

        function init() {
            loadConfig();
            setupEvents();
            showAlert('Welcome! Click Settings to configure or Demo Mode to test.', 'info');
        }

        function loadConfig() {
            const saved = localStorage.getItem('dwConfig');
            if (saved) {
                appConfig = JSON.parse(saved);
                document.getElementById('apiKey').value = appConfig.apiKey || '';
                document.getElementById('sheetId').value = appConfig.sheetId || '';
                if (appConfig.apiKey && appConfig.sheetId) enableButtons();
            }
        }

        function setupEvents() {
            document.getElementById('setupBtn').onclick = () => showSetup(true);
            document.getElementById('demoBtn').onclick = toggleDemo;
            document.getElementById('saveBtn').onclick = saveConfig;
            document.getElementById('testBtn').onclick = testConnection;
            document.getElementById('cancelBtn').onclick = () => showSetup(false);
            document.getElementById('qrBtn').onclick = generateQR;
            document.getElementById('initBtn').onclick = initialize;
            document.getElementById('refreshBtn').onclick = refresh;
        }

        function showAlert(msg, type) {
            const alert = document.getElementById('alert');
            alert.textContent = msg;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 4000);
        }

        function showSetup(show) {
            document.getElementById('setupForm').classList.toggle('hidden', !show);
            document.getElementById('mainPanel').classList.toggle('hidden', show);
            document.getElementById('demoData').classList.add('hidden');
        }

        function toggleDemo() {
            isDemoMode = !isDemoMode;
            document.getElementById('demoData').classList.toggle('hidden', !isDemoMode);
            document.getElementById('mainPanel').classList.toggle('hidden', isDemoMode);
            document.getElementById('setupForm').classList.add('hidden');
            if (isDemoMode) {
                enableButtons();
                showAlert('Demo mode activated!', 'info');
            }
        }

        function exitDemo() {
            isDemoMode = false;
            document.getElementById('demoData').classList.add('hidden');
            document.getElementById('mainPanel').classList.remove('hidden');
        }

        function saveConfig() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const sheetId = document.getElementById('sheetId').value.trim();
            
            if (!apiKey || !sheetId) {
                showAlert('Please enter both API key and Sheet ID', 'error');
                return;
            }

            appConfig = { apiKey, sheetId };
            localStorage.setItem('dwConfig', JSON.stringify(appConfig));
            showAlert('Configuration saved!', 'success');
            showSetup(false);
            enableButtons();
        }

        function testConnection() {
            const sheetId = document.getElementById('sheetId').value.trim();
            if (!sheetId) {
                showAlert('Enter Sheet ID first', 'error');
                return;
            }

            showAlert('Testing connection...', 'info');
            fetch(`https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`)
                .then(r => r.ok ? r.text() : Promise.reject('Failed'))
                .then(csv => {
                    const lines = csv.split('\n').length - 1;
                    showAlert(`‚úÖ Success! Found ${lines} data rows.`, 'success');
                })
                .catch(() => showAlert('‚ùå Connection failed. Check Sheet ID and make sure sheet is published.', 'error'));
        }

        function enableButtons() {
            document.getElementById('qrBtn').disabled = false;
            document.getElementById('refreshBtn').disabled = false;
        }

        function initialize() {
            if (!appConfig.apiKey || !appConfig.sheetId) {
                showAlert('Configure settings first', 'warning');
                return;
            }
            showAlert('Initializing...', 'info');
            loadMap();
        }

        function loadMap() {
            if (appConfig.apiKey) {
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${appConfig.apiKey}&callback=initMap`;
                document.head.appendChild(script);
            }
        }

        window.initMap = function() {
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: { lat: 34.0522, lng: -118.2437 }
            });
            showAlert('Map loaded successfully!', 'success');
        };

        function generateQR() {
            const url = isDemoMode ? 
                'https://maps.google.com/maps?q=34.0522,-118.2437' :
                'https://maps.google.com/maps?q=stores+near+me';
            
            showQRModal('üì± Location QR', url, isDemoMode ? 'Demo location' : 'Your locations');
        }

        function generateDemoQR() {
            showQRModal('üì± Demo QR', 'https://maps.google.com/maps?q=34.0522,-118.2437', 'Downtown LA demo location');
        }

        function showQRModal(title, url, desc) {
            document.getElementById('qrTitle').textContent = title;
            document.getElementById('qrDesc').innerHTML = `<p>${desc}</p><a href="${url}" target="_blank" class="btn btn-secondary">Open in Maps</a>`;
            
            const qrDiv = document.getElementById('qrCode');
            qrDiv.innerHTML = '';
            
            if (typeof QRCode !== 'undefined') {
                new QRCode(qrDiv, {
                    text: url,
                    width: 256,
                    height: 256,
                    correctLevel: QRCode.CorrectLevel.L
                });
            } else {
                qrDiv.innerHTML = '<p>QR library not loaded</p>';
            }
            
            document.getElementById('qrModal').style.display = 'flex';
        }

        function closeQR() {
            document.getElementById('qrModal').style.display = 'none';
        }

        function refresh() {
            showAlert(isDemoMode ? 'Demo refreshed!' : 'Data refreshed!', 'success');
        }

        // Global functions
        window.generateDemoQR = generateDemoQR;
        window.exitDemo = exitDemo;
        window.closeQR = closeQR;
    </script>
</body>
</html>
